<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ログイン</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="login-container">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">ログイン</h1>
        <div id="alert-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
            <strong class="font-bold">エラー:</strong>
            <span class="block sm:inline" id="alert-text"></span>
        </div>
        <div class="input-group">
            <label for="username" class="input-label">ID:</label>
            <input type="text" id="username" class="input-field" placeholder="IDを入力" autofocus>
        </div>
        <div class="input-group">
            <label for="password" class="input-label">パスワード:</label>
            <input type="password" id="password" class="input-field" placeholder="パスワードを入力">
        </div>
        
        </div>

    <button id="power-off-button" class="power-off-button mt-6">
        <i class="fas fa-power-off"></i> アプリケーション終了
    </button>

    <script>
        let activeInput = null;
        // let shiftMode = false; // shiftMode 変数も不要になるため削除

        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const alertMessage = document.getElementById('alert-message');
        const alertText = document.getElementById('alert-text');

        // activeInput の設定は、ブラウザのソフトキーボードを使用する場合は不要ですが、
        // 念のため残しておきます。
        usernameInput.addEventListener('focus', () => activeInput = usernameInput);
        passwordInput.addEventListener('focus', () => activeInput = passwordInput);

        // ===== Electron APIモック（変更なし） =====
        if (!window.electronAPI) {
            window.electronAPI = {
                authenticateUser: async (username, password) => {
                    if (username === 'master' && password === '1111') {
                        return { success: true };
                    } else {
                        return { success: false, message: 'IDまたはパスワードが間違っています。' };
                    }
                },
                navigateTo: (page) => {
                    const map = {
                        index: 'index.html',
                        login: 'login.html'
                    };
                    location.href = map[page] || 'index.html';
                },
                quitApp: () => {
                    alert('アプリを終了（モック）');
                }
            };
        }
        window.onload = () => {
            // 履歴スタックを無効化する（戻る・進む無効化）
            history.pushState(null, null, location.href);
            window.onpopstate = () => {
                history.go(1); // 戻る操作をキャンセル
            };
        };

        window.addEventListener('pageshow', (event) => {
            if (event.persisted) {
                // bfcacheから復帰した時、一度だけリロードする
                window.location.reload();
            }
        });

        // バーチャルキーボードのクリック処理を削除
        // document.querySelectorAll('.key').forEach(key => { ... }); を削除

        // ログイン処理（変更なし）
        async function login() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!username || !password) {
                showAlert('IDとパスワードを入力してください。');
                return;
            }

            try {
                const result = await window.electronAPI.authenticateUser(username, password);
                if (result.success) {
                    window.electronAPI.navigateTo('index');
                } else {
                    showAlert(result.message || 'ログインに失敗しました。');
                }
            } catch (error) {
                console.error(error);
                showAlert('ログイン中にエラーが発生しました。');
            }
        }

        function showAlert(message) {
            alertText.textContent = message;
            alertMessage.classList.remove('hidden');
        }

        // アプリ終了ボタン（変更なし）
        document.getElementById('power-off-button').addEventListener('click', () => {
            window.electronAPI.quitApp();
        });

        // Enterキーでもログイン（変更なし）
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>
