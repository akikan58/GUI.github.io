<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ログイン</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="login-container">
    <h1 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1.5rem; color: #333; text-align: center;">
        ログイン
    </h1>
    
    <div id="alert-message" class="hidden bg-red-50 border border-red-200 text-red-600 px-3 py-2 rounded text-xs mb-4">
        <span id="alert-text"></span>
    </div>

    <div class="input-group">
        <label for="username" class="input-label">ユーザーID</label>
        <input type="text" id="username" class="input-field" placeholder="IDを入力">
    </div>

    <div class="input-group">
        <label for="password" class="input-label">パスワード</label>
        <input type="password" id="password" class="input-field" placeholder="••••••••">
    </div>

    <button onclick="login()" class="login-submit-btn">
        ログイン
    </button>
</div>

    <button id="power-off-button" class="power-off-button">
        <i class="fas fa-power-off"></i> 終了
    </button>

    <!-- 省略: head, bodyタグはそのまま -->

    <script>
        let activeInput = null;
        let shiftMode = false;

        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const alertMessage = document.getElementById('alert-message');
        const alertText = document.getElementById('alert-text');

        usernameInput.addEventListener('focus', () => activeInput = usernameInput);
        passwordInput.addEventListener('focus', () => activeInput = passwordInput);

        // ===== Electron APIモック =====
        if (!window.electronAPI) {
            window.electronAPI = {
                authenticateUser: async (username, password) => {
                    if (username === 'master' && password === '1111') {
                        return { success: true };
                    } else {
                        return { success: false, message: 'IDまたはパスワードが間違っています。' };
                    }
                },
                navigateTo: (page) => {
                    const map = {
                        index: 'index.html',
                        login: 'login.html'
                    };
                    location.href = map[page] || 'index.html';
                },
                quitApp: () => {
                    alert('アプリを終了（モック）');
                }
            };
        }
        window.onload = () => {
            // 履歴スタックを無効化する（戻る・進む無効化）
            history.pushState(null, null, location.href);
            window.onpopstate = () => {
                history.go(1); // 戻る操作をキャンセル
            };
        };

        window.addEventListener('pageshow', (event) => {
            if (event.persisted) {
                // bfcacheから復帰した時、一度だけリロードする
                window.location.reload();
            }
        });

        

        // ログイン処理
        async function login() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!username || !password) {
                showAlert('IDとパスワードを入力してください。');
                return;
            }

            try {
                const result = await window.electronAPI.authenticateUser(username, password);
                if (result.success) {
                    window.electronAPI.navigateTo('index');
                } else {
                    showAlert(result.message || 'ログインに失敗しました。');
                }
            } catch (error) {
                console.error(error);
                showAlert('ログイン中にエラーが発生しました。');
            }
        }

        function showAlert(message) {
            alertText.textContent = message;
            alertMessage.classList.remove('hidden');
        }

        // アプリ終了ボタン
        document.getElementById('power-off-button').addEventListener('click', () => {
            window.electronAPI.quitApp();
        });

        // Enterキーでもログイン
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>


