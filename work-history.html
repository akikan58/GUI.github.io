<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作業履歴</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="work-history.css">
</head>
<body>
    <div class="header-band">
        <div class="date-time-display">作業履歴</div>
    </div>

    <div class="main-content-wrapper">
        <div class="history-card bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="p-6 bg-gray-200">
                <h1 class="text-3xl font-bold text-center text-gray-800">過去の作業履歴</h1>
            </div>
            
            <div class="p-6 flex-grow overflow-y-auto">
                <div id="history-table-container">
                    </div>
            </div>
        </div>
        
        <div class="back-to-home-button-container">
            <button id="back-to-home-button" class="interactive-button back-button">
                <i class="fas fa-arrow-left"></i>
                <span>ホームに戻る</span>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const historyTableContainer = document.getElementById('history-table-container');
            const backToHomeButton = document.getElementById('back-to-home-button');

            // 1. ダミーデータ (新しいカテゴリーに対応)
            const DUMMY_HISTORY_DATA = [
                // workerId, recordDate, startTime, endTime, manufacturedCount, defectiveCount
                { id: 1, workerId: 'M1001', recordDate: '2023/11/24', startTime: '10:00', endTime: '10:04', manufacturedCount: 50, defectiveCount: 2 }, // 不良率: 4.0%
                { id: 2, workerId: 'M1002', recordDate: '2023/11/24', startTime: '10:10', endTime: '10:12', manufacturedCount: 15, defectiveCount: 0 }, // 不良率: 0.0%
                { id: 3, workerId: 'M1001', recordDate: '2023/11/23', startTime: '15:30', endTime: '15:42', manufacturedCount: 120, defectiveCount: 1 }, // 不良率: 0.8%
                { id: 4, workerId: 'M1003', recordDate: '2023/11/23', startTime: '20:00', endTime: '20:03', manufacturedCount: 30, defectiveCount: 3 }, // 不良率: 10.0%
                { id: 5, workerId: 'M1002', recordDate: '2023/11/22', startTime: '09:00', endTime: '09:08', manufacturedCount: 80, defectiveCount: 0 }, // 不良率: 0.0%
                { id: 6, workerId: 'M1004', recordDate: '2023/11/22', startTime: '13:00', endTime: '13:05', manufacturedCount: 45, defectiveCount: 4 }, // 不良率: 8.9%
            ];

            // 2. テーブルレンダリング関数 (新しいカテゴリーに対応)
            function renderHistoryTable(data) {
                if (data.length === 0) {
                    historyTableContainer.innerHTML = '<p class="text-center text-gray-500 py-10">履歴データがありません。</p>';
                    return;
                }

                const table = document.createElement('table');
                table.classList.add('min-w-full', 'divide-y', 'divide-gray-200', 'text-sm');
                
                // ヘッダー: 作業者ID, 記録日時, 開始時刻, 終了時刻, 製造個数, 不良数, 不良率
                table.innerHTML = `
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">作業者ID</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">記録日時</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">開始時刻</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">終了時刻</th>
                            <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">製造個数</th>
                            <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">不良数</th>
                            <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">不良率</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${data.map((item, index) => {
                            // 不良率の計算
                            const defectRate = item.manufacturedCount > 0 
                                ? ((item.defectiveCount / item.manufacturedCount) * 100).toFixed(1) 
                                : '0.0';

                            return `
                                <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-blue-50 transition duration-150">
                                    <td class="px-3 py-3 whitespace-nowrap text-gray-900">${item.workerId}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-gray-900">${item.recordDate}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-gray-500">${item.startTime}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-gray-500">${item.endTime}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-right text-blue-600 font-bold">${item.manufacturedCount}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-right ${item.defectiveCount > 0 ? 'text-red-600' : 'text-gray-700'} font-bold">${item.defectiveCount}</td>
                                    <td class="px-3 py-3 whitespace-nowrap text-right font-semibold text-gray-700">${defectRate}%</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                `;

                historyTableContainer.appendChild(table);
            }

            // 初期表示
            renderHistoryTable(DUMMY_HISTORY_DATA);

            // 3. ホームに戻るボタンのイベント
            backToHomeButton.addEventListener('click', () => {
                if (typeof electronAPI !== 'undefined' && electronAPI.navigateTo) {
                    electronAPI.navigateTo('index');
                }else{
                    location.href = 'index.html';
                }
            });
        });
    </script>
</body>
</html>
